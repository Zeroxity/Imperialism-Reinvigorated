#ON ACTIONS ARE NOT MODULAR, ONLY ONE OVERWRITE WILL LOAD PER MOD - ANY MODMODS MUST ADAPT THIS FILE
on_startup = {
	events = {
		muslim_school_events.20 #Pick School
	}
	initialize_schools_effect = yes #This is only used here but is used for readability of on_action file.
	emperor = { save_global_event_target_as = Emperor } # Just do "emperor" to scope to it
	if = {
		limit = {
			is_emperor_of_china = yes
		}
		save_global_event_target_as = EmperorOfChina
	}	
	if = {
		limit = {
			has_dlc = "Cradle of Civilization"
			has_country_modifier = tur_janissary
		}
		remove_country_modifier = tur_janissary
	}
	#IR INIT DEV AND COHESION
	set_global_flag = IR_global_climate_A #INIT CLIMATE
	set_hre_religion_treaty = no
	if = { #STANDARD START
		limit = { NOT = { has_global_flag = IR_dev_init } }
		5125 = { 
			save_global_event_target_as = dev_calc 
			set_variable = { which = IR_climate_progress value = 0 }
			if = {
				limit = { start_date = 1444.11.11 }
				province_event = { id = IR_development.3 days = 50 }
			}
			else_if = {
				limit = { start_date = 1444.11.12 }
				province_event = { id = IR_development.3 days = 49 }
			}
			else_if = {
				limit = { start_date = 1444.11.13 }
				province_event = { id = IR_development.3 days = 48 }
			}
			else_if = {
				limit = { start_date = 1444.11.14 }
				province_event = { id = IR_development.3 days = 47 }
			}
			else_if = {
				limit = { start_date = 1444.11.15 }
				province_event = { id = IR_development.3 days = 46 }
			}
		}
		4400 = { save_global_event_target_as = food_market set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } }
		4401 = { save_global_event_target_as = textile_market set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } }
		4402 = { save_global_event_target_as = luxury_market set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } }
		4403 = { save_global_event_target_as = spice_market set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } }
		#
		1779 = { save_global_event_target_as = grain_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1781 = { save_global_event_target_as = wine_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1782 = { save_global_event_target_as = wool_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1783 = { save_global_event_target_as = cloth_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1784 = { save_global_event_target_as = fish_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1785 = { save_global_event_target_as = fur_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1786 = { save_global_event_target_as = salt_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1787 = { save_global_event_target_as = naval_supplies_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1788 = { save_global_event_target_as = copper_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1789 = { save_global_event_target_as = iron_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1790 = { save_global_event_target_as = slaves_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1791 = { save_global_event_target_as = ivory_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1793 = { save_global_event_target_as = tea_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1794 = { save_global_event_target_as = chinaware_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1795 = { save_global_event_target_as = spices_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1796 = { save_global_event_target_as = coffee_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1797 = { save_global_event_target_as = cotton_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1798 = { save_global_event_target_as = sugar_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1799 = { save_global_event_target_as = tobacco_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1801 = { save_global_event_target_as = cocoa_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1802 = { save_global_event_target_as = silk_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1803 = { save_global_event_target_as = tropical_wood_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1804 = { save_global_event_target_as = dyes_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1807 = { save_global_event_target_as = livestock_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1814 = { save_global_event_target_as = incense_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1173 = { save_global_event_target_as = glass_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		1950 = { save_global_event_target_as = gems_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		2194 = { save_global_event_target_as = paper_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		2200 = { save_global_event_target_as = bt_trade_good_beer_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		2251 = { save_global_event_target_as = bt_trade_good_books_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		2334 = { save_global_event_target_as = ir_rice_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		2426 = { save_global_event_target_as = ir_whales_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		2740 = { save_global_event_target_as = ir_silver_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		2936 = { save_global_event_target_as = ir_potatoes_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		4146 = { save_global_event_target_as = ir_maize_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		4154 = { save_global_event_target_as = ir_millet_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		4156 = { save_global_event_target_as = ir_apiculture_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		4157 = { save_global_event_target_as = ir_fruit_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		4159 = { save_global_event_target_as = ir_olives_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		4160 = { save_global_event_target_as = ir_dates_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		4161 = { save_global_event_target_as = ir_marble_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		4162 = { save_global_event_target_as = ir_softwood_store set_variable = { which = IR_price_mod value = 1 } set_variable = { which = IR_goods_size value = 0 } set_variable = { which = IR_demand_value value = 0 } set_variable = { which = IR_trading_number value = 0 } }
		every_province = {
			limit = { is_city = yes }
			IR_check_dev_variables = yes #includes check climate
			set_variable = { which = IR_wealth_progress value = 1 }
			set_variable = { which = IR_pop_progress value = 50 }
		}
		every_province = {
			limit = { is_empty = yes }
			IR_check_climate = yes
			set_variable = { which = IR_wealth_progress value = 1 }
			set_variable = { which = IR_pop_progress value = 1 }
		}
		every_country = {
			limit = { is_subject = yes OR = { is_subject_of_type = fief is_subject_of_type = dominion } NOT = { has_country_flag = IR_subj_prog_init } }
			IR_check_subj_variables = yes
			set_variable = { which = IR_subj_cohesion value = 0 }
			set_country_flag = IR_subj_prog_init
			overlord = { set_country_flag = overlord_of_@PREV }
		}
		set_global_flag = IR_dev_init
	}
	#BT AND BR INIT
	set_global_flag = beyond_typus_mod_enabled
	set_global_flag = integrated_byz_events_used
	BYZ = { set_country_flag = rebellious_demetrios_flag }
	
	
	##############################
	#consolidated alt start setup#
	#by date
	if = {
		limit = { started_in = 1459.1.1 }
		set_global_flag = constantinople_restored
		TUR = { set_country_flag = relocated_capital_constantinople }
	}	#Preventing exploits relating to Contaninople's growth.
	if = {
		limit = {
			started_in = 1495.1.1
			NOT = { started_in = 1648.1.1 }
		}
		clr_global_flag = italy_out_of_HRE
	}
	if = {
		limit = {
			tag = FRA
			started_in = 1789.7.14
			NOT = { is_year = 1790 }
			NOT = { has_disaster = french_revolution }
		}
		add_disaster_progress = {
			value = 100
			disaster = french_revolution
		}
	}
	#general
	if = {
		limit = {
			OR = {
				tag = UBV
				tag = LBV
				tag = ING
			}
			NOT = { has_country_flag = new_flavour_bav_13_has_been_triggered }
		}
		set_country_flag = new_flavour_bav_13_has_been_triggered
		country_event = { id = new_flavour_bav.13 days = 90 } #better not to allow almost instant DOWs
	}
	##############################
	#
	#ENG = { country_event = { id = IR_flavor_FRA.10 days = 0 } }
	#FRA = { country_event = { id = IR_flavor_FRA.11 days = 0 } }
	#
	if = { limit = { ai = no } country_event = { id = setup.99 days = 0 } } # IR INTRO EVENT
	if = { 
		limit = { started_in = 1444.11.11 NOT = { started_in = 1444.11.16 } }
		country_event = {
			id = IR_flavor_LAND.1
			days = 0
		}
	}
	#SET BASE EVENT_TARGETS IN MISSIONS
	#HAB = {
	#	save_event_target_as = fra_habsburg_rival_tag1
	#	save_event_target_as = fra_habsburg_rival_tag2
	#}
	if = {
		limit = {
			started_in = 1444.11.10
		}
		HUN = { remove_historical_friend = HAB }
	}
	#if = {
	#	limit = {	
	#		OR = { technology_group = western technology_group = eastern } 
	#		NOT = { 
	#			IR_peasant_freedom_exceptions = yes
	#		}
	#	}
	#	set_estate_privilege = estate_peasants_serfdom
	#}
}

#IR Dev Cap update every increase in dev
# province
on_adm_development = {
	ROOT = { hidden_effect = { IR_check_dev_variables = yes } }
	owner = { add_adm_power = -5 add_treasury = -25 }
}

# province
on_dip_development = {
	ROOT = { hidden_effect = { IR_check_dev_variables = yes } }
	owner = { add_mil_power = -25 add_treasury = -50 }
}

# province
on_mil_development = {
	add_base_manpower = -1
	IR_check_dev_variables = yes
	province_event = { id = census.1 days = 0 }
}


# country 
on_new_monarch = {
	crimean_succession_effect = yes #Scripted effect
	slesvig_question_effect = yes #Scripted effect
	if = {
		limit = {
			has_consort_regency = no
			any_owned_province = {
				has_province_modifier = domain_of_spouses_family
			}
		}
		random_owned_province = {
			limit = { has_province_modifier = domain_of_spouses_family }
			remove_province_modifier = domain_of_spouses_family
		}
	}
	if = {
		limit = {
			has_consort_regency = no
			any_owned_province = {
				has_province_modifier = home_of_consort
			}
		}
		random_owned_province = {
			limit = { has_province_modifier = home_of_consort }
			remove_province_modifier = home_of_consort
		}
	}
	if = {
		limit = {
			NOT = { has_dlc = "Mandate of Heaven" }
			has_country_modifier = the_mandate_of_heaven
			NOT = { legitimacy = 80 }
		}
		country_event = { id = china_events.32 }	# History of last ruler 
	}
	#ambrosian_republic_effect = yes
	succession_culture_religion_effect = yes
	sheik_ul_islam_effect = yes
	hab_remove_mission_mods_if_not_emperor_effect = yes
	thu_remain_von_wettin_effect = yes
	ladislaus_postumus_union_effect = yes
	#burgundian_inheritance_start_effect = yes
	ladislaus_postumus_king_died_effect = yes
	if = {
		limit = {
			tag = SAX
			has_country_flag = sax_thuringen_split_to_happen
			OR = {
				NOT = { dynasty = "von Wettin" }
				NOT = { senior_union_with = THU }
				has_regency = yes
			}
		}
		clr_country_flag = sax_thuringen_split_to_happen
	} #MERGE WITH IR SAXONY
	if = {
		limit = {
			tag = NAV
		}
		trigger_switch = { 
			on_trigger = has_country_flag
			magdalena_regency_flag = {
				country_event = { id = IR_flavor_NAV.19 days = 10 }
			}
			catalina_navarra_heiress_flag = { country_event = { id = IR_flavor_NAV.20 days = 1 } }
		}
	}
	events = {
		tribal_succession.1		# Harsh anti-tribals.
		9492 					# Remove some event modifiers
		flavor_boh.8			# Winter King in Prague
		flavor_kol.1			# Bavarian Archbishop
		war_of_the_roses.101	# WotR - House of Lancaster wins
		war_of_the_roses.102	# WotR - House of York wins
		war_of_the_roses.106	# WotR - Another dynasty has seized the throne
		flavor_tur.102			# Janissary Reward
		flavor_ori.7			# Hamvira Victorious
		flavor_kbo.1			# The two branches of the Sayfawa dynasty
		flavor_kbo.8			# Sayfawa pretenders
		flavor_zan.5			# Coup of Coup of Suleiman and Muhammad al-Mazlum.
		purple_phoenix.1		# BYZ pretenders
		flavor_pol.3480			# The Pacta Conventa
		protestantism_events.15	# Catholic Leaning Monarch
		tengri_events.17		# Keep the Khojas in Power?
		flavor_brapru.22		# Succession of Albrecht Achilles
		flavor_brapru.25		# Dispositio Achillea (can also trigger from flavor_brapru.22)
		flavor_nor.27			# Proclamation in Hamar
		china_events.43			# Picking new Capital for China
		celestial_empire_events.3 #Resistance to Sinicization
		flavor_boh.2			#Heretic Kings
		flavor_hun.17			#Maintaining the Black Army
		flavor_tim.1			#Death of Shah Rukh
		muslim_school_events.20 #No Religious School
		flavor_daimyo.4			#Shiba Yoshikado
	}
	random_events = { 
		1000 = 0
		100 = flavor_kol.1		# Bavarian Archbishop
		100 = flavor_hsa.3		# Hansa: Tagfahrt
		100 = inti_events.1		# Birth of a Panaca
		50 = dynastic_events.4	
		50 = dynastic_events.5	
		25 = harem_events.7		#Failed Policy of Fratricide
	}
	#Apparently, the above vanilla code below must be included in any mod, else problems arise.... absolutely bizarre, but what can one do?
	if = {
		limit = {
			has_reform = high_kingship_legacy
			NOT = { has_country_flag = bt_abolition_of_tanistry_succession }
		}
		set_country_flag = bt_tanistry_king_just_died
		clr_country_flag = bt_tanistry_high_queen_reigning
		remove_country_modifier = bt_uncertainty_about_a_high_queen
		country_event = { id = BeyondTypusCelticFlavour.1 days = 1 }				#New Tanist election
		country_event = { id = BeyondTypusCelticFlavour.6 days = 1 }			#High Queen comes to power, will only fire for female rulers
	}
	#IR
	if = {
		limit = {
			tag = TAN
			NOT = { has_country_flag = IR_flavor_NAP.10_happened }
			is_subject_of = NAP
		}
		country_event = { id = IR_flavor_NAP.10 days = 0 }
	}
}

# country
on_monarch_death = {
	events = {
		#Country Flavor
		flavor_tus.16 #Savanorola Leaves This World
		flavor_wal.1 # Vlad the Impaler. So that he doesn't try to usurp his father.
		flavor_sax.8 # Treaty of Leipzig
#		flavor_pap.16 # Borgia Pope
#		flavor_pap.19 # death of borgia pope
		flavor_tus.22 # Medici Pope
		flavor_tus.24 # death of the Medici Pope
		#IR
		IR_flavor_SPA.1 # Juan Castile passing
		IR_flavor_POR.11 # Henrique passes away 
		IR_flavor_FRA.28
	}
	#Apparently, the below vanilla code below must be included in any mod, else problems arise.... absolutely bizarre, but what can one do?
	if = {
		limit = {
			tag = ANS
			BRA = {
				has_country_flag = albrecht_achilles_flag
			}
		}
		BRA = {
			clr_country_flag = albrecht_achilles_flag #Just to be sure
			kill_heir = yes #If Albrecht Achilles dies in Ansbach he will also be dead in Brandenburg, will appear as normal death of heir to BRA.
		}
	}
	if = {
		limit = {
			tag = SAX
			has_country_flag = sax_thuringen_split_to_happen
			OR = {
				NOT = { dynasty = "von Wettin" }
				NOT = { senior_union_with = THU }
				has_regency = yes
			}
		}
		clr_country_flag = sax_thuringen_split_to_happen
	}
	if = {
		limit = { has_country_modifier = sought_after_bachelor }
		remove_country_modifier = sought_after_bachelor
	}
	if = {
		limit = {
			tag = ARA
			has_country_flag = aragon_monarch_flag
		}
		NAV = {
			country_event = { id = flavor_ara.7 days = 0 }
#			country_event = { id = IR_flavor_NAV.4 days = 1 }
		}
	}
	if = {
		limit = {
			tag = NAV
		}
		trigger_switch = { 
			on_trigger = has_country_flag
			john2_flag = { NAV = { country_event = { id = IR_flavor_NAV.9 days = 0 } } }
			francis_febo_flag = { NAV = { country_event = { id = IR_flavor_NAV.18 days = 0 } } }
			Iberian_succession_flag = {  NAV = { country_event = { id = IR_flavor_NAV.21 days = 0 } } }
		}
	}
	if = {
		limit = {
			has_reform = high_kingship
			NOT = { has_country_flag = bt_abolition_of_tanistry_succession }
		}
		set_country_flag = bt_tanistry_king_just_died
		clr_country_flag = bt_tanistry_high_queen_reigning
		remove_country_modifier = bt_uncertainty_about_a_high_queen
		remove_country_modifier = bt_tanistry_underaged_heir
		remove_country_modifier = bt_tanistry_female_heir
		remove_country_modifier = bt_tanistry_waiting_on_heir
	}
	if = { 
		limit = {
			OR = {
				tag = BOH
				tag = HUN
			}
			has_reform = special_elective_reform
		}
		ROOT = { 
			country_event = {
				id = IR_flavor_elective.1
				days = 0
			}
		}
	}
	if = {
		limit = {
			tag = SCO
			has_country_flag = IR_flavor_FRA.3_happened
		}
		SCO = { country_event = { id = IR_flavor_FRA.300 } }
	}
	if = {
		limit = {
			tag = SCO
			has_country_flag = IR_flavor_FRA.300_happened
		}
		FRA = { create_union = SCO }
	}	
}

# country
on_heir_death = {
	#Apparently, the below vanilla code below must be included in any mod, else problems arise.... absolutely bizarre, but what can one do?
	if = {
		limit = { has_country_flag = heir_dip_education }
		clr_country_flag = heir_dip_education
	}
	if = {
		limit = { has_country_flag = heir_mil_education }
		clr_country_flag = heir_mil_education
	}
	if = {
		limit = { has_country_flag = heir_adm_education }
		clr_country_flag = heir_adm_education
	}
	if = {
		limit = { has_ruler_flag = well_advised_tutored_heir }
		clr_ruler_flag = well_advised_tutored_heir
	}
	if = {
		limit = { has_ruler_flag = heir_went_on_grand_tour }
		clr_ruler_flag = heir_went_on_grand_tour
	}
	if = {
		limit = { has_country_flag = albrecht_achilles_flag }
		clr_country_flag = albrecht_achilles_flag #Death of original Albrecht Achilles
	}
	if = {
		limit = { has_ruler_flag = sancaga_cikma }
		clr_ruler_flag = sancaga_cikma
		every_owned_province = {
			limit = {
				has_province_modifier = heir_in_training
			}
			remove_province_modifier = heir_in_training
		}
	}
	if = {
		limit = { has_ruler_flag = returned_from_sancaga_sikma_province }
		clr_ruler_flag = returned_from_sancaga_sikma_province
	}
	#Apparently, the above vanilla code below must be included in any mod, else problems arise.... absolutely bizarre, but what can one do?
	if = {
		limit = {
			has_reform = high_kingship
			NOT = { has_country_flag = bt_abolition_of_tanistry_succession }
		}
		remove_country_modifier = bt_tanistry_underaged_heir
		remove_country_modifier = bt_tanistry_female_heir
		country_event = { id = BeyondTypusCelticFlavour.8 days = 1 }			#Tanist dies, new tanist event
	}
}

on_consort_death = {
	#if = {
	#	limit = {
			#has_country_flag = catherine_medici_france_consort
	#	}
		#country_event = { id = IR_flavor_FRA.24 }
	#}	
}

on_regent = {
	if = {
		limit = {
			NOT = { has_global_flag = death_of_haji_giray } #Also set in history.
			tag = CRI
			exists = TUR
			is_subject = no
			TUR = {
				num_of_cities = ROOT
				is_subject = no
				num_of_ports = 1
			}
		}
		country_event = { id = flavor_cri.1 } #Death of Haji Giray
	}
	if = {
		limit = {
			NOT = { has_global_flag = death_of_haji_giray } #Also set in history.
			tag = CRI
			OR = {
				NOT = { exists = TUR }
				is_subject = yes
				TUR = { NOT = { num_of_cities = ROOT } }
				TUR = { is_subject = yes }
				TUR = { NOT = { num_of_ports = 1 } }
			}
		}
		set_global_flag = death_of_haji_giray
	}
	events = {
		tribal_succession.1	# harsh anti-tribals.
		flavor_tim.1			#Death of Shah Rukh
		flavor_daimyo.4			#Shiba Yoshikado
	}
}

# country
on_new_term_election = {
	events = {
		700		# Election event
		elections.720		# Dutch Republic
		IR_govt_native.1 #Primitive Council Election
		IR_govt_tribal.1 #Tribal Council Election
		IR_govt_tribal.3 #Tribal Confederation election
		pirates.1
	}
}

# country
on_death_election = {
	if = {
		limit = { has_reform = presidential_despot_reform }
		remove_government_reform = presidential_despot_reform
	}
	if = {
		limit = {
			has_reform = pirate_republic_reform
		}
		set_country_flag = pirate_death_election
		country_event = { id = pirates.1 }
	}
	events = {
		701		# Election event
		elections.721		# Dutch Republic
		IR_govt_native.1 #Standard Council Election
		IR_govt_tribal.1 #Tribal Council Election
		IR_govt_tribal.2 #Tribal Dictatorial Election
		IR_govt_tribal.3 #Tribal Confederation Election
		elections.800	# Lottery election
		#Flavor
		flavor_tus.16 #Savonarola Leaves This World
	}
}

# country
# root = winning country, from = loser country
on_war_won = {
	if = {
		limit = {
			tag = CAT
			FROM = { tag = NAV }
			PRO = {
				has_country_flag = rene_intervenes_for_catalonia_flag
			}
		}
		PRO = {
			country_event = { id = IR_flavor_NAV.16 days = 1 }
		}
	}
}
# country
# root = loser country, from = winner country
on_war_lost = {
    if = {
        limit = {
            tag = CAT
            FROM = { tag = NAV }
            PRO = {
                has_country_flag = rene_intervenes_for_catalonia_flag
            }
        }
        PRO = {
            clr_country_flag = rene_intervenes_for_catalonia_flag
        }
    }
}
#IR
# root = losing country, from = location
on_siege_lost_country = {
	events = {
		curia.8
		papacy_events.5
	}
}
on_siege_won_province = {
	events = {
		synthetic_dawn.4
	}
	if = {
		limit = {
			from = {
				tag = REB
				is_rebel_type = revolutionary_rebels
			}
			owner = {
				any_owned_province = {
					region = root
					has_revolution_in_province = yes
				}
				NOT = { has_disaster = french_revolution }
				NOT = { has_disaster = revolution }
				NOT = { has_spawned_rebels = revolutionary_rebels }
			}
		}
		owner = { country_event = { id = center_of_revolution.1600 } }
	}
	# IR-wealth loss on siege - removed for now
	#if = {
	#	limit = { base_tax = 2 }
	#	add_base_tax = -1
	#}
}

# province
on_province_religion_converted = {
	if = {
		limit = {
			religion_group = muslim
		}
		if = {
			limit = { owner = { culture_group = turkish_g } }
			if = { 
				limit = { culture = bulgarian }
				change_culture = torbeshi
			}
			if = { 
				limit = { OR = { culture = bosnian culture = zachlumian culture = serbian } }
				change_culture = bosniak
			}
			if = { 
				limit = { culture_group = dacian }
				change_culture = gagauz
			}
			if = { 
				limit = { province_group = thrace_group }
				change_culture = turkish
			}
		}
		if = {
			limit = { mindanao_common_provinces = yes }
			change_culture = bangsamoro
		}
		if = { 
			limit = { culture = andalucian }
			change_culture = andalusi_culture
		}
	}
}

# province
on_province_culture_converted = {
}

# THIS = Province, FROM = Country who Propogated
on_convert_by_trade_policy = {
	if = {
		limit = {
			trade_company_region = trade_company_moluccas
			FROM = { is_defender_of_faith = yes }
		}
		FROM = {
			if = {
				limit = {
					ai = no
					NOT = { check_variable = { which = religion_propagated_in_moluccas value = 1 } }
				}
				set_variable = {
					which = religion_propagated_in_moluccas value = 1
				}
			}
			else_if = {
				limit = {
					ai = no
					check_variable = { which = religion_propagated_in_moluccas value = 1 }
					NOT = { check_variable = { which = religion_propagated_in_moluccas value = 6 } }
				}
				change_variable = {
					which = religion_propagated_in_moluccas value = 1
				}
			}
		}
	}
}

# province
# FROM = old owner
on_province_owner_change = {
	events = {
		japan.1
	}
	if = { 
		limit = { is_city = yes NOT = { has_province_flag = IR_dev_prog_init } }
		IR_check_dev_variables = yes
		set_variable = { which = IR_wealth_progress value = 1 }
		set_variable = { which = IR_pop_progress value = 50 }
		set_province_flag = IR_dev_prog_init
	}
	if = {
		limit = {
			OR = {
				has_province_modifier = wine_bonus_prod
				has_province_modifier = grain_bonus_prod
			}
			FROM = { has_reform = monastic_breweries_reform }
			NOT = { owner = { has_reform = monastic_breweries_reform } }
		}
		remove_province_modifier = wine_bonus_prod
		remove_province_modifier = grain_bonus_prod
	}
	
	if = {
		limit = {
			NOT = {
				OR = {
					has_province_modifier = wine_bonus_prod
					has_province_modifier = grain_bonus_prod
				}
			}
			owner = { has_reform = monastic_breweries_reform }
			NOT = { FROM = { has_reform = monastic_breweries_reform } }
		}
		hidden_effect = {
			if = {
				limit = {
					trade_goods = wine
				}
				add_province_modifier = { 
					name = wine_bonus_prod
					duration = -1
					hidden = yes
				}
			}
			if = {
				limit = {
					trade_goods = grain
				}
				add_province_modifier = { 
					name = grain_bonus_prod
					duration = -1
					hidden = yes
				}
			}
		}
	}

	if = {
		limit = {
			owned_by = SRU
			exists = ARA
		}
		ARA = {
			set_country_flag = ARA_defeat_saruhan
		}
	}
	if = {
		limit = {
			NOT = { owner = { religion_group = muslim } }
			has_province_modifier = sufi_shrine
		}
		remove_province_modifier = sufi_shrine
	}
	on_province_owner_change_estate_privileges_effect = yes
}

# FROM = Previous Country, ROOT = Province
on_company_chartered = {
	if = {
		limit = {
			OR = {
				region = bengal_region
				region = hindusthan_region
				region = west_india_region
				region = deccan_region
				region = coromandel_region
			}
		}
		ROOT = {
			owner = {
				set_country_flag = the_coin_is_stronger_than_the_sword
			}
		}
	}
}

# ROOT = Overlord, FROM = Minor #IR- Jupiter added
on_dependency_gained = {
	FROM = {
		if = {
			limit = {
				OR = { is_subject_of_type = personal_union is_subject_of_type = dominion is_subject_of_type = paramountcy }
			}
			every_subject_country = {
				limit = {
					is_subject_of_type = personal_union
				}
				ROOT = {
					create_subject = {
						subject_type = personal_union
						subject = PREV
					}
				}
			}
			every_subject_country = {
				limit = {
					is_subject_of_type = dominion
				}
				ROOT = {
					create_subject = {
						subject_type = dominion
						subject = PREV
					}
				}
			}
			every_subject_country = {
				limit = {
					is_subject_of_type = paramountcy
				}
				ROOT = {
					create_subject = {
						subject_type = paramountcy
						subject = PREV
					}
				}
			}
		}
		if = {
			limit = {
				OR = { is_subject_of_type = fief is_subject_of_type = dominion }
			}
			if = {
				limit = { NOT = { has_country_flag = IR_subj_prog_init } }
				set_variable = { which = IR_subject_cohesion value = 0 }
				set_country_flag = IR_subj_prog_init
			}
			else_if = { 
				limit = { NOT = { overlord = { has_country_flag = overlord_of_@PREV }}}
				every_known_country = { clr_country_flag = overlord_of_@PREV }	#clear previous overlord if changed hands in peace
				overlord = { set_country_flag = overlord_of_@PREV }
				set_variable = { which = IR_subject_cohesion value = 0 }
			}
		}
	}
	
	events = {
		dutch_republic.31 # States General falls under a PU
	}
}

# ROOT = Overlord, FROM = Minor
on_dependency_lost = {
	FROM = {
		if = {
			limit = { is_subject = no has_country_flag = IR_subj_prog_init }
				set_variable = { which = IR_subject_cohesion value = 0 }
				clr_country_flag = IR_subj_prog_init
				every_known_country = { clr_country_flag = overlord_of_@PREV }	#clear overlord flag if no longer a subject
			}
		}
}

# ROOT = New vassal, FROM = Overlord
on_create_vassal = {
	if = {
		limit = {
			has_dlc = "Emperor"
			FROM = {
				is_revolutionary = yes
			}
		}
		change_government = republic
		add_government_reform = junior_revolutionary_republic_reform
		set_country_flag = had_revolution
	}
	if = {
		limit = {
			tag = PAP
		}
		change_government = theocracy
		#add_government_reform = papacy_reform
		adopt_reform_progress = FROM
	}
	if = {
		limit = {
			has_reform = confederal_republic_reform
		}
		FROM = {
			create_subject = {
				subject_type = confederate
				subject = ROOT
			}
		}
		change_government = republic
		add_government_reform = united_cantons_reform
		adopt_reform_progress = FROM
	}
	if = {
		limit = {
			FROM = { has_reform = religious_permanent_revolution_reform }
			NOT = { tag = PAP }
		}
		change_religion = FROM
		adopt_reform_progress = FROM
		add_country_modifier = {
			name = global_holy_war_released_modifier
			duration = 3650
			hidden = yes
		}
		capital_scope = {
			change_religion = FROM
		}
	}
	if = {
		limit = {
			is_fief_domain_tech = yes
			OR = { current_age = age_of_discovery current_age = age_of_reformation } 
			FROM = { culture_group = ROOT }
		}
		FROM = {
			create_subject = {
				subject_type = fief
				subject = ROOT
			}
		}
	}
}


# this = Released country, FROM = Releasing country
on_country_released = {
	if = {
		limit = {
			tag = PAP
		}
		change_government = theocracy
		add_government_reform = papacy_reform
		adopt_reform_progress = FROM
	}
}

on_country_creation = {
	if = {
		limit = {
			tag = PAP
			OR = {
				NOT = {
					religion = catholic
				}
				NOT = {
					has_reform = papacy_reform
				}
				NOT = {
					government = theocracy
				}
			}
		}
		change_religion = catholic
		change_government = theocracy
		add_government_reform = papacy_reform
	}
}


# THIS = Province

on_reform_enacted = {
}

on_reform_changed = {
}

on_trade_company_investment = {
}

on_center_of_trade_upgrade = {

}

on_center_of_trade_downgrade = {

}

on_culture_promoted = {

}

# ROOT = Country establishing it
# First province in state is set
on_holy_order_established = {

}

# When a minority is expelled to a colony
# THIS = Colony, ROOT = Colony, FROM = Home province
on_minority_expelled = {

}

# THIS = Raiding country, FROM = Sea province
on_raid_coast = {
	if = {
		limit = {
			has_faction = pr_buccaneers
		}
		add_faction_influence = {
			faction = pr_buccaneers
			influence = 1
		}
	}
}

# ROOT = Tag that captured the flagship, FROM = Tag that lost the flagship
on_flagship_captured = {
	FROM = {
		set_country_flag = captured_flagship_country_flag
	}
	ROOT = {
		country_event = { id = flagship_events.2 }
		set_country_flag = trophy_hunter_flag
	}
	FROM = {
		country_event = { id = flagship_events.1 }
	}
}

# ROOT = Tag that destroyed the flagship, FROM = Tag that lost the flagship
on_flagship_destroyed = {
	FROM = {
		set_country_flag = sunk_flagship_country_flag
	}
	ROOT = {
		country_event = { id = flagship_events.4 }
	}
	FROM = {
		country_event = { id = flagship_events.3 }
	}
}

on_conquest = {
	remove_named_unrest = estate_land_seized
}


